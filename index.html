<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>O terror de OPT</title>
  <style> 
    body {
      font-family: Arial, sans-serif;
    }
    #messages { list-style-type: none; margin: 0; padding: 0; }
    #messages li { padding: 5px 10px; }
    #messages li:nth-child(odd) { background: #eee; }

    #activeUsers { list-style-type: none; margin: 0; padding: 0; }
    #activeUsers li { padding: 5px 10px; }
  </style>
</head>
<body>
  <div id="login">
    <input type="text" id="usernameInput" placeholder="Selecione seu nome">
    <button onclick="submitUsername()">Alterar</button>
  </div>

  <div id="chat" style="display: none;">
    <ul id="messages"></ul>
    <form id="form">
      <input id="m" autocomplete="off" />
      <input type="url" id="imgUrlInput" placeholder="URL da imagem">
      <button>Enviar</button>
      <button type="button" onclick="clearMessages()">Apagar Todas</button>
    </form>
    <ul id="activeUsers"></ul> <!-- Lista de usuários ativos -->
    <div id="roomSelection">
      <label for="room">Selecione uma sala:</label>
      <select name="room" id="room" onchange="changeRoom()">
        <option value="terror-de-opt">Terror de OPT</option>
        <option value="inimigos-da-bola">Inimigos da Bola</option>
      </select>
      <input type="password" id="passwordInput" placeholder="Senha da sala">
    </div>
  </div>

  <div id="schedule">
    <h2>Horário</h2>
    <p id="nextClass">Próxima aula: <span id="nextClassTime"></span></p>
  </div>
  
  <script src="/socket.io/socket.io.js"></script>
  <script>
    var socket = io();
    var username;
    var password = {
      'terror-de-opt': 'sonia',
      'inimigos-da-bola': 'mariana'
    };

    function submitUsername() {
      var usernameInput = document.getElementById('usernameInput');
      if (usernameInput.value.trim() !== '') {
        username = usernameInput.value.trim();
        document.getElementById('login').style.display = 'none';
        document.getElementById('chat').style.display = 'block';
      }
    }

    function clearMessages() {
      var pass = prompt("Por favor, insira a senha para apagar todas as mensagens:");
      if (pass === password[document.getElementById('room').value]) {
        var confirmation = confirm("Tem certeza de que deseja apagar todas as mensagens?");
        if (confirmation) {
          socket.emit('clear messages', username);
          document.getElementById('messages').innerHTML = ''; // Clear messages on client side
          var item = document.createElement('li');
          item.textContent = `SISTEMA: ${who} coringou e apagou todas as mensagens`;
          document.getElementById('messages').appendChild(item);
          window.scrollTo(0, document.body.scrollHeight);
        }
      } else {
        alert("Senha incorreta!");
      }
    }

    function changeRoom() {
      var pass = prompt("Por favor, insira a senha para entrar na sala:");
      if (pass === password[document.getElementById('room').value]) {
        socket.emit('change room', document.getElementById('room').value);
        document.getElementById('messages').innerHTML = ''; // Clear messages when changing room
      } else {
        alert("Senha incorreta!");
      }
    }

    document.getElementById('form').addEventListener('submit', function(event) {
      event.preventDefault(); // Prevent form submission
      var input = document.getElementById('m');
      var imgUrlInput = document.getElementById('imgUrlInput');
      if (input.value.trim() !== '' || imgUrlInput.value.trim() !== '') {
        var message = {
          username: username,
          text: input.value.trim(),
          imgUrl: imgUrlInput.value.trim() || null
        };
        socket.emit('chat message', message);
        input.value = ''; // Clear input field after sending
        imgUrlInput.value = ''; // Clear image URL input field after sending
      }
    });

    socket.on('chat message', function(msg) {
      var item = document.createElement('li');
      var content = '';
      if (msg.imgUrl) {
        content += `<img src="${msg.imgUrl}" alt="Image" style="max-width: 800px; max-height: 800px;">`;
      }
      content += `<strong>${msg.username}:</strong> ${msg.text}`;
      item.innerHTML = content;
      document.getElementById('messages').appendChild(item);
      window.scrollTo(0, document.body.scrollHeight);
    });

    socket.on('clear messages', function(who) {
      var item = document.createElement('li');
      item.textContent = `SISTEMA: ${who} coringou e apagou todas as mensagens`;
      document.getElementById('messages').appendChild(item);
      window.scrollTo(0, document.body.scrollHeight);
    });

    socket.on('active users', function(users) {
      var activeUsersList = document.getElementById('activeUsers');
      activeUsersList.innerHTML = '';
      users.forEach(function(user) {
        var item = document.createElement('li');
        item.textContent = user;
        activeUsersList.appendChild(item);
      });
    });

    // Horário
    function getNextClass() {
      var now = new Date();
      var dayOfWeek = now.getDay();
      var hours = now.getHours();
      var minutes = now.getMinutes();
      var classTime = '';

      switch (dayOfWeek) {
        case 1: // Monday
          if ((hours == 7 && minutes >= 30) || (hours > 7 && hours < 12)) {
            classTime = 'Literatura';
          } else if ((hours == 8 && minutes >= 20) || (hours > 8 && hours < 9)) {
            classTime = 'Literatura';
          } else if ((hours == 9 && minutes >= 10) || (hours > 9 && hours < 9)) {
            classTime = 'Filosofia';
          } else if ((hours == 9 && minutes >= 25) || (hours > 9 && hours < 10)) {
            classTime = 'Matemática';
          } else if ((hours == 10 && minutes >= 25) || (hours > 10 && hours < 11)) {
            classTime = 'Inglês';
          } else if ((hours == 11 && minutes >= 20) || (hours > 11 && hours < 12)) {
            classTime = 'Biologia';
          }
          break;
        case 2: // Tuesday
          if ((hours == 7 && minutes >= 30) || (hours > 7 && hours < 8)) {
            classTime = 'Física';
          } else if ((hours == 8 && minutes >= 20) || (hours > 8 && hours < 9)) {
            classTime = 'Matemática';
          } else if ((hours == 9 && minutes >= 10) || (hours > 9 && hours < 9)) {
            classTime = 'Biologia';
          } else if ((hours == 9 && minutes >= 25) || (hours > 9 && hours < 10)) {
            classTime = 'LP-G';
          } else if ((hours == 10 && minutes >= 15) || (hours > 10 && hours < 11)) {
            classTime = 'Língua Inglesa';
          } else if ((hours == 11 && minutes >= 20) || (hours > 11 && hours < 12)) {
            classTime = 'Física';
          }
          break;
        case 3: // Wednesday
          if ((hours == 7 && minutes >= 30) || (hours > 7 && hours < 8)) {
            classTime = 'Literatura';
          } else if ((hours == 8 && minutes >= 20) || (hours > 8 && hours < 9)) {
            classTime = 'Matemática';
          } else if ((hours == 9 && minutes >= 10) || (hours > 9 && hours < 9)) {
            classTime = 'ER';
          } else if ((hours == 9 && minutes >= 25) || (hours > 9 && hours < 10)) {
            classTime = 'Língua Inglesa';
          } else if ((hours == 10 && minutes >= 15) || (hours > 10 && hours < 11)) {
            classTime = 'Física';
          } else if ((hours == 11 && minutes >= 20) || (hours > 11 && hours < 12)) {
            classTime = 'Química';
          }
          break;
        case 4: // Thursday
          if ((hours == 7 && minutes >= 30) || (hours > 7 && hours < 8)) {
            classTime = 'OPT';
          } else if ((hours == 8 && minutes >= 20) || (hours > 8 && hours < 9)) {
            classTime = 'OPT';
          } else if ((hours == 9 && minutes >= 10) || (hours > 9 && hours < 9)) {
            classTime = 'CH-GEO';
          } else if ((hours == 9 && minutes >= 25) || (hours > 9 && hours < 10)) {
            classTime = 'QUI';
          } else if ((hours == 10 && minutes >= 25) || (hours > 10 && hours < 11)) {
            classTime = 'MAT';
          } else if ((hours == 11 && minutes >= 20) || (hours > 11 && hours < 12)) {
            classTime = 'MAT';
          }
          break;
        case 5: // Friday
          if ((hours == 7 && minutes >= 30) || (hours > 7 && hours < 8)) {
            classTime = 'Química';
          } else if ((hours == 8 && minutes >= 20) || (hours > 8 && hours < 9)) {
            classTime = 'Biologia';
          } else if ((hours == 9 && minutes >= 10) || (hours > 9 && hours < 9)) {
            classTime = 'CH-SOC';
          } else if ((hours == 9 && minutes >= 25) || (hours > 9 && hours < 10)) {
            classTime = 'História';
          } else if ((hours == 10 && minutes >= 25) || (hours > 10 && hours < 11)) {
            classTime = 'História';
          } else if ((hours == 11 && minutes >= 20) || (hours > 11 && hours < 12)) {
            classTime = 'CH-GEO';
          }
          break;
      }

      return classTime;
    }

    function updateNextClass() {
      var nextClass = getNextClass();
      if (nextClass !== '') {
        document.getElementById('nextClassTime').textContent = nextClass;
      } else {
        document.getElementById('nextClassTime').textContent = 'Nenhuma aula programada';
      }
    }

    updateNextClass();
    setInterval(updateNextClass, 60000); // Atualizar a cada minuto
  </script>
</body>
</html>
